<!DOCTYPE html>
<html>
<head>
  <title>Anonymous Forum</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; }
    .post { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
    .post .color-block { width: 20px; height: 20px; display: inline-block; vertical-align: middle; margin-right: 10px; }
    .timestamp { font-size: 0.8em; color: #666; }
  </style>
</head>
<body>
  <h1>Anonymous Forum</h1>
  <form action="/submit" method="POST" enctype="multipart/form-data">
    <textarea name="text" rows="3" cols="50" placeholder="Your message" required></textarea><br>
    <label for="color">Choose post color: </label>
    <input type="color" id="color" name="color" value="#ff0000"><br><br>
    <label for="image">Upload image (optional): </label>
    <input type="file" id="image" name="image" accept="image/*"><br><br>
    <button type="submit">Post</button>
  </form> 
  <form action="/search" method="GET">
  <input type="text" name="q" placeholder="Search posts..." required>
  <button type="submit">Search</button>
</form>


  <hr>

  <% posts.forEach(function(post) { %>
    <div class="post">
      <div class="color-block" style="background-color: post color"></div>
      <strong>Posted at: </strong><span class="timestamp"><%= new Date(post.timestamp).toLocaleString() %></span>
      <p><%= post.text %></p>
      <% if (post.image) { %>
        <img src="<%= post.image %>" alt="Post Image" style="max-width: 100%; max-height: 300px;" />
      <% } %>

      <% if (post.replies && post.replies.length) { %>
        <div style="margin-left:20px; border-left: 2px solid #ddd; padding-left: 10px;">
          <h4>Replies:</h4>
          <% post.replies.forEach(function(reply) { %>
            <p><em><%= new Date(reply.timestamp).toLocaleString() %>:</em> <%= reply.text %></p>
          <% }) %>
        </div>
      <% } %>

      <form action="/reply/<%= post.id %>" method="POST" style="margin-top:10px;">
        <input type="text" name="text" placeholder="Reply..." required />
        <button type="submit">Reply</button>
      </form>
    </div>
  <% }) %>
 <!-- Search form -->
  <form action="/search" method="GET">
    <input type="text" name="q" placeholder="Search posts..." value="<%= query || 'fight' %>" required>
    <button type="submit">Search</button>
  </form>

  <% if (typeof query !== 'undefined') { %>
    <h3>Showing results for "<%= query %>"</h3>
    <a href="/">Clear search</a>
  <% } %>

  <h2>Posts</h2>
  <ul>
    <% posts.forEach(post => { %>
      <li>
        <%= query ? post.text.replace(new RegExp(query, 'gi'), '<mark>$&</mark>') : post.text %>
      </li>
    <% }) %>
  </ul>

  <% if (typeof topKeywords !== 'undefined') { %>
    <h3>Top Keywords:</h3>
    <ul>
      <% topKeywords.forEach(word => { %>
        <li><a href="/search?q=<%= word %>"><%= word %></a></li>
      <% }) %>
    </ul>
  <% } %>
</body>
</html>
